<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerenciador de Senhas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f6fa;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #2c3e50;
      color: white;
    }
    button {
      padding: 6px 12px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .create-btn { background: #27ae60; color: white; }
    .edit-btn   { background: #2980b9; color: white; }
    .delete-btn { background: #c0392b; color: white; }
    .toggle-btn { background: #7f8c8d; color: white; }
    .logout-btn { background: #e67e22; color: white; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>üîê Locker - Gerenciador de Senhas</h1>
    <button class="logout-btn" onclick="logout()">üö™ Logout</button>
  </div>
  
  <button class="create-btn" onclick="createEntry()">‚ûï Criar Novo</button>
  
  <table id="lockerTable">
    <thead>
      <tr>
        <th>Site</th>
        <th>Usu√°rio</th>
        <th>Senha</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas v√£o ser inseridas dinamicamente -->
    </tbody>
  </table>

  <script>
    async function loadData() {
      const res = await fetch("/home", { headers: { "Accept": "application/json" } });
      const data = await res.json();
      const tbody = document.querySelector("#lockerTable tbody");
      tbody.innerHTML = "";

      data.forEach((row, idx) => {
        const tr = document.createElement("tr");

        // Coluna: site
        const tdSite = document.createElement("td");
        tdSite.textContent = row.site;
        tr.appendChild(tdSite);

        // Coluna: usu√°rio
        const tdUser = document.createElement("td");
        tdUser.textContent = row.user;
        tr.appendChild(tdUser);

        // Coluna: senha + bot√£o mostrar/ocultar
        const tdSenha = document.createElement("td");

        const span = document.createElement("span");
        span.id = "pw-" + idx;
        span.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"; // senha escondida
        span.dataset.password = row.password; // senha real

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "toggle-btn";
        toggleBtn.textContent = "üëÅ";
        toggleBtn.onclick = () => togglePassword(idx);

        tdSenha.appendChild(span);
        tdSenha.appendChild(toggleBtn);
        tr.appendChild(tdSenha);

        // Coluna: a√ß√µes
        const tdAcoes = document.createElement("td");

        const editBtn = document.createElement("button");
        editBtn.className = "edit-btn";
        editBtn.textContent = "Editar";
        editBtn.onclick = () => editEntry(row.site);

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "Excluir";
        deleteBtn.onclick = () => deleteEntry(row.site);

        tdAcoes.appendChild(editBtn);
        tdAcoes.appendChild(deleteBtn);
        tr.appendChild(tdAcoes);

        tbody.appendChild(tr);
      });  
    }

    function togglePassword(id) {
      const span = document.getElementById("pw-" + id);
      if (span.textContent === "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢") {
        span.textContent = span.dataset.password;
      } else {
        span.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
      }
    }

    async function createEntry() {
      const site = prompt("Digite o nome do site:");
      const user = prompt("Digite o usu√°rio:");
      if (!site || !user) return;
      const res = await fetch("/home", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ site, user })
      });
      const data = await res.json();
      alert("Criado com sucesso!\nSenha gerada: " + data.password);
      loadData();
    }

    async function editEntry(site) {
      const user = prompt("Digite o novo usu√°rio:");
      if (!user) return;
      const res = await fetch("/home", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ site, user })
      });
      const data = await res.json();
      if (res.ok) {
        alert("Atualizado com sucesso!\nNova senha: " + data.password);
        loadData();
      } else {
        alert(data.error);
      }
    }

    async function deleteEntry(site) {
      if (!confirm("Deseja excluir o site " + site + "?")) return;
      const res = await fetch("/home", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ site })
      });
      const data = await res.json();
      if (res.ok) {
        alert(data.message);
        loadData();
      } else {
        alert(data.error);
      }
    }

    function logout() {
      window.location.href = "/logout";
    }

    loadData();
  </script>
</body>
</html>
